From: Sam Macbeth <sam@cliqz.com>
Date: Fri, 18 Sep 2020 12:09:36 +0200
Subject: Override UA for addons.mozilla.org

---
 browser/extensions/webcompat/data/ua_overrides.js   | 13 +++++++++++++
 .../components/extensions/WebExtensionPolicy.cpp    |  6 +++---
 2 files changed, 16 insertions(+), 3 deletions(-)

diff --git a/browser/extensions/webcompat/data/ua_overrides.js b/browser/extensions/webcompat/data/ua_overrides.js
index 86f02a5237..ac525ffdc6 100644
--- a/browser/extensions/webcompat/data/ua_overrides.js
+++ b/browser/extensions/webcompat/data/ua_overrides.js
@@ -34,6 +34,19 @@ const AVAILABLE_UA_OVERRIDES = [
       },
     },
   },
+  {
+    /* UA override for addons.mozilla.org so they think we're vanilla Firefox */
+    id: "amo-override",
+    platform: "all",
+    domain: "addons.mozilla.org",
+    bug: "0000001",
+    config: {
+      matches: ["*://addons.mozilla.org/*"],
+      uaTransformer: originalUA => {
+        return originalUA.substring(0, originalUA.indexOf('Ghostery') - 1);
+      },
+    },
+  },
   {
     /*
      * Bug 1577519 - att.tv - Create a UA override for att.tv for playback on desktop
diff --git a/toolkit/components/extensions/WebExtensionPolicy.cpp b/toolkit/components/extensions/WebExtensionPolicy.cpp
index 48a8fb1a1c..c154cb5e87 100644
--- a/toolkit/components/extensions/WebExtensionPolicy.cpp
+++ b/toolkit/components/extensions/WebExtensionPolicy.cpp
@@ -432,9 +432,9 @@ bool WebExtensionPolicy::IsRestrictedURI(const URLInfo& aURI) {
     return true;
   }
 
-  if (AddonManagerWebAPI::IsValidSite(aURI.URI())) {
-    return true;
-  }
+  // if (AddonManagerWebAPI::IsValidSite(aURI.URI())) {
+  //   return true;
+  // }
 
   return false;
 }
-- 
2.25.1

